@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor Accessor

@model IEnumerable<TenderTracker.Models.TenderModel>

@if (TempData["SuccessMessage"] != null)
{
    <script>
        alert('@TempData["SuccessMessage"]');
    </script>
}
@if (TempData["Success"] != null)
{
    <script>
        alert('@TempData["Success"]');
    </script>
}
@if (TempData["ErrorMessage"] != null)
{
    <script>
        alert('@TempData["ErrorMessage"]');
    </script>
}
<title>@ViewData["Title"] - TenderTracker</title>
<body>
<div class="content-wrapper">
    <section>
        <div>
            @{
                var user_type = Accessor.HttpContext.Session.GetString("user_type");
                var Name = Accessor.HttpContext.Session.GetString("Name");
            }
        </div>
        <div class="container-fluid">
            <div class="row m-3">
                <h3 class="col-md-8">All Tenders List</h3>
            </div>

            <div class="card">
                <div class="card-body">
                    <table id="example" class="table table-responsive table-bordered  table-hover" style="display:block;">
                        <thead>
                            <tr>
                                <th class="bg-primary text-light">S.NO.</th>
                                <th class="bg-primary text-light">Empanelment Type</th>
                                <th class="bg-primary text-light">Tender No.</th>
                                <th class="bg-primary text-light">Department</th>
                                <th class="bg-primary text-light">State</th>
                                <th class="bg-primary text-light">City</th>
                                <th class="bg-primary text-light" style="min-width: 80px;">Tender Due Date</th>
                                <th class="bg-primary text-light">Assigned To</th>
                                <th class="bg-primary text-light">Submitted Date</th>
                                @if (user_type != "3")
                                {
                                    <th class="bg-primary text-light">Action</th>
                                }
                            </tr>
                        </thead>
                        <tbody id="tenderTableBody">
                            @{

                                int i = 0;
                                foreach (var item in Model)
                                {
                                    i++;
                                    // Retrieve remark status; if null, leave empty
                                    var remarkStatus = item.rowData.tender_remark ?? "";
                                    <tr data-remark-status="@remarkStatus">
                                        <td>@i</td>
                                        <td>@item.rowData.Empanelment_type</td>
                                        <td>@item.rowData.Tender</td>
                                        <td>@item.rowData.Department</td>
                                        <td>@item.rowData.State</td>
                                        <td>@item.rowData.City</td>
                                        @*<td>@item.rowData.Tender_due_date</td>*@
                                        <td>@(Convert.ToDateTime(item.rowData.Tender_due_date).ToString("dd-MM-yyyy"))</td>
                                        <td>
                                            @(string.IsNullOrEmpty(item.rowData.Name) ? "N/A" : item.rowData.Name)
                                        </td>
                                        <td>@(Convert.ToDateTime(item.rowData.created_date).ToString("dd-MM-yyyy"))</td>
                                        @if (user_type != "3")
                                        {
                                            <td>
                                                @{
                                                    var linkColor = string.IsNullOrEmpty(item.rowData.tender_remark) ? "btn-primary" : "btn-primary";
                                                }
                                                <a asp-action="ViewTender" asp-controller="Dashboard" asp-route-id="@item.rowData.id" class="btn @linkColor">View</a>
                                            </td>
                                        }
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>
</div>
</body>

<!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.1.0/css/buttons.dataTables.min.css">

<!-- jQuery (Required for DataTables) -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<!-- DataTables JavaScript -->
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.1.0/js/dataTables.buttons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.1.0/js/buttons.html5.min.js"></script>

<!-- DataTables Initialization with RowCallback for Custom Row Coloring -->
<script>
    $(document).ready(function () {
        var table = $('#example').DataTable({
            stripeClasses: [],  // Disable default stripe classes
            paging: true,
            lengthMenu: [5, 10, 25, 50],
            pageLength: 10,
            searching: true,
            ordering: true,
            info: true,
            responsive: true,
            language: {
                "paginate": {
                    "first": "First",
                    "last": "Last",
                    "next": "Next",
                    "previous": "Prev"
                }
            },
            dom: '<"d-flex justify-content-between"fB>rt<"d-flex justify-content-between"lp i>',
            buttons: [
                {
                    extend: 'csvHtml5',
                    text: 'Export',
                    className: 'btn btn-success'
                }
            ],
            // Use rowCallback to apply our custom color based on data-remark-status
            rowCallback: function (row, data, index) {

                var remarkStatus = $(row).attr("data-remark-status");
                // If remarkStatus is non-empty and not "N/A", set one color; otherwise, another.
                if (remarkStatus && remarkStatus.trim() !== "" && remarkStatus !== "N/A") {
                    // $(row).css("background-color", "#D4EDDA").css("color", "black");
                $(row).css({
            "background-color": "#D4EDDA", // Light Green
            "color": "black",
            "border": "1px solid #dee2e6" // Adds border
        });
                } else {
                  //  $(row).css("background-color", "#F8F9FA").css("color", "black").css("border", "1px solid #dee2e6");
                $(row).css({
            "background-color": "#F8F9FA", // Light Gray
            "color": "black",
            "border": "1px solid #dee2e6"
        });
                }
            }
        });

        // Force export button functionality if needed
        $('#exportButton').on('click', function () {
            table.button('.buttons-csv').trigger();
        });
    });
           $(document).ready(function () {
        $("#tenderTableBody tr").each(function () {
            $(this).css("border", "1px solid #dee2e6"); // Apply blue border to tr
            $(this).find("td").css("border", "1px solid #dee2e6"); // Apply blue border to td
        });
    });

</script>

<!-- Custom CSS to force cell styling to inherit row colors -->
<style>
    /* Override DataTables sorting_1 class on table cells */
    #tenderTableBody tr td.sorting_1 {
        background-color: inherit !important;
        color: inherit !important;
    }
    /* Ensure all cells inside rows with our custom data attribute inherit the row's styling */
    #tenderTableBody tr[data-remark-status] td {
        background-color: inherit !important;
        color: inherit !important;
    }
</style>
