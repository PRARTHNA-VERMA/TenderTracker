@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

@using (Html.BeginForm())
{
    @Html.ValidationSummary(true)
}
@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor Accessor

@model IEnumerable<TenderTracker.Models.TenderModel>

@if (TempData["SuccessMessage"] != null)
{
    <script>
        alert('@TempData["SuccessMessage"]');
    </script>
}
@if (TempData["Success"] != null)
{
    <script>
        alert('@TempData["Success"]');
    </script>
}
@if (TempData["ErrorMessage"] != null)
{
    <script>
        alert('@TempData["ErrorMessage"]');
    </script>
}

<div class="content-wrapper">
    <section>
        <div>
            @{
                var user_type = Accessor.HttpContext.Session.GetString("user_type");
                var Name = Accessor.HttpContext.Session.GetString("Name");
            }
        </div>
        <div class="container-fluid">
            <div class="row m-3">
                <h3 class="col-md-8">Pending Tenders Remark</h3>
                @* <div class="col-md-4 d-flex justify-content-end">
                <a asp-controller="Dashboard" asp-action="AddCredit" method="post" class="btn btn-primary "> + Add Credit</a>
            </div> *@
            </div>


            <div class="card">
                <div class="card-body">
                    @* <div class="d-flex justify-content-end mb-2">
                        <button id="exportButton" class="btn btn-success">Export</button>
                    </div> *@
                    <table id="example" class="table table-responsive table-bordered table-striped table-hover" style="display:block;">
                        <thead>

                            <tr>
                                <th class="bg-primary text-light">S.NO.</th>
                                <th class="bg-primary text-light">Empanelment Type</th>
                                <th class="bg-primary text-light">Tender No.</th>
                                <th class="bg-primary text-light">Department</th>
                                <th class="bg-primary text-light">State</th>
                                <th class="bg-primary text-light">City</th>
                                @* <th class="bg-primary text-light">Manpower</th>
                                <th class="bg-primary text-light">EMD</th>
                                <th class="bg-primary text-light">Tender Fee</th>
                                <th class="bg-primary text-light">Pre-Bid Date</th> *@
                                <th class="bg-primary text-light">Tender Due Date</th>
                                @* <th class="bg-primary text-light">Remarks</th> *@
                                @*<th class="bg-primary text-light">created_date</th>*@
                                <th class="bg-primary text-light">Assigned To</th>
                                <th class="bg-primary text-light">Submitted Date</th>
                                @if (user_type != "3")
                                {
                                    <th class="bg-primary text-light">Action</th>
                                }

                                @* <th class="bg-primary text-light">Tender File</th> *@
                            </tr>

                        </thead>
                        <tbody id="tenderTableBody">
                            @{
                                int i = 0;

                                foreach (var item in Model)
                                {
                                    i++;
                                    var remarkStatus = item.rowData.tender_remark; // Get remark_status value


                                    <tr data-remark-status="@remarkStatus">
                                        <td>@i</td>
                                        <td>@item.rowData.Empanelment_type</td>
                                        <td>@item.rowData.Tender</td>
                                        <td>@item.rowData.Department</td>
                                        <td>@item.rowData.State</td>
                                        <td>@item.rowData.City</td>
                                        @*<td>@item.rowData.Tender_due_date</td>*@
                                        <td>@(Convert.ToDateTime(item.rowData.Tender_due_date).ToString("dd-MM-yyyy"))</td>
                                        <td>
                                            @(string.IsNullOrEmpty(item.rowData.Name) ? "N/A" : item.rowData.Name)
                                        </td>
                                        <td>@(Convert.ToDateTime(item.rowData.created_date).ToString("dd-MM-yyyy"))</td>

                                        @if (user_type != "3")
                                        {
                                            <td>
                                                @{
                                                    var linkColor = string.IsNullOrEmpty(item.rowData.tender_remark) ? "btn-primary" : "btn-success";
                                                }
                                                <a asp-action="ViewTender" asp-controller="Dashboard" asp-route-id="@item.rowData.id" class="btn @linkColor">View</a>
                                                <input type="hidden" name="id" value="@item.rowData.id" />
                                            </td>
                                        }

                                    </tr>
                                }
                            }
                        </tbody>

                    </table>
                </div>

            </div>



        </div>
    </section>
</div>
<!--data table ui ends-->
<!-- Remove duplicate jQuery -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<!-- Load DataTables JS only once -->
<script src="https://cdn.datatables.net/2.1.5/js/dataTables.js"></script>
<script src="https://cdn.datatables.net/buttons/2.1.0/js/dataTables.buttons.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.1.0/js/buttons.html5.min.js"></script>

<!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.1.0/css/buttons.dataTables.min.css">

<script>
    $(document).ready(function () {
        // ✅ Initialize DataTable with Pagination
        var table = $('#example').DataTable({
            paging: true,            // Enable Pagination
            lengthMenu: [5, 10, 25, 50], // Rows per page options
            pageLength: 10,          // Default rows per page
            searching: true,         // Enable Search
            ordering: true,          // Enable Sorting
            info: true,              // Show Table Info
            responsive: true,        // Responsive Mode
            language: {
                "paginate": {
                    "first": "First",
                    "last": "Last",
                    "next": "Next",
                    "previous": "Prev"
                }
            },
            dom: '<"d-flex justify-content-between"fB>rt<"d-flex justify-content-between"lp i>',
            buttons: [
                {
                    extend: 'csvHtml5',
                    text: 'Export',
                    className: 'btn btn-success'
                }
            ]
        });

        // ✅ Ensure Export Button Works
        $('#exportButton').on('click', function () {
            table.button('.buttons-csv').trigger();
        });

        // ✅ Row Color Based on Remark Status
        $("#tenderTableBody tr").each(function () {
            var remarkStatus = $(this).attr("data-remark-status");
            if (remarkStatus && remarkStatus !== "N/A") {
                $(this).css("background-color", "red").css("color", "white");
            } else {
                $(this).css("background-color", "gray").css("color", "white");
            }
        });
    });
</script>
